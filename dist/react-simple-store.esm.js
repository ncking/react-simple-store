import{useState as t,useEffect as e}from"react";const r=(r,o={},n={})=>{let s=!1,c={...o};const a=new Set,{allowNested:i=!0}=n,l=(t,e)=>{if(!i&&s)throw new Error("Nested state mutation disabled");try{s=!0;const r="function"==typeof t?t(c):t;if(!Object.is(r,c)){if("object"!=typeof r)throw new Error("next state not object");const t=c;c=e?r:{...c,...r},a.forEach(e=>e(c,t))}}finally{s=!1}},u=()=>c,f=t=>(a.add(t),()=>{a.delete(t)}),b=(t,e,r,o=t(c))=>{let n=o;return()=>{const o=t(c);(r?r(n,o):Object.is(n,o))||(e(o,n),n=o)}},d=function(){var t=[].slice.call(arguments);return f(t[1]?b(...t):t[0])};return{...r(l,u,{subscribe:d}),useStore:(r,o,n=!1)=>{const[{v:s,r:a},i]=t({v:r(c),r:!!n});return e(()=>{const t=b(r,t=>i({v:t,r:a}),o,s);return t(),f(t)},a?[r]:[]),s},getState:u,setState:l,destroy:()=>a.clear(),subscribe:d}},o=(t,e)=>r((e,r)=>({dispatch:o=>(e(t(r(),o)),o)}),e);export{r as createStore,o as createStoreRedux};
