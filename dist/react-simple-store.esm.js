import{useState as t,useEffect as e,createElement as r}from"react";const n=(r,n={},o={})=>{let c=!1,s={...n};const i=new Set,{allowNested:a=!0}=o,l=(t,e)=>{if(!a&&c)throw new Error("Nested state mutation disabled");try{c=!0;const r="function"==typeof t?t(s):t;if(!Object.is(r,s)){if("object"!=typeof r)throw new Error("next state not object");const t=s;s=e?r:{...s,...r},i.forEach(e=>e(s,t))}}finally{c=!1}},u=()=>s,b=t=>(i.add(t),()=>{i.delete(t)}),f=(t,e,r,n=t(s))=>{let o=n;return()=>{const n=t(s);(r?r(o,n):Object.is(o,n))||(e(n,o),o=n)}},p=function(){var t=[].slice.call(arguments);return b(t[1]?f(...t):t[0])};return{...r(l,u,{subscribe:p}),useStore:(r,n,o=!1)=>{const[{v:c,r:i},a]=t({v:r(s),r:!!o});return e(()=>{const t=f(r,t=>a({v:t,r:i}),n,c);return t(),b(t)},i?[r]:[]),c},getState:u,setState:l,destroy:()=>i.clear(),subscribe:p}},o=(t,e)=>{if(Object.is(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;const o=Object.prototype.hasOwnProperty.bind(e);for(let n=0;n<r.length;n++){const c=r[n];if(!o(c)||!Object.is(t[c],e[c]))return!1}return!0},c=(t,e)=>{const c=n((e,r)=>({dispatch:n=>e(t(r(),n))}),e),{useStore:s,dispatch:i}=c;return c.connect=(t,e)=>n=>{const c=c=>{const a=s(t,o);return r(n,{...c,...a,...e(i)})};return c.displayName=`Connect(${n.displayName||n.name||"Component"})`,c},c};export{n as createStore,c as createStoreRedux};
