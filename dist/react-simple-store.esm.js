import{useState as t,useEffect as e}from"react";const r=(r,o={},n={})=>{let s=!1,c={...o};const i=new Set,{allowNested:a=!0}=n,l=(t,e)=>{if(!a&&s)throw new Error("Nested state mutation disabled");try{s=!0;const r="function"==typeof t?t(c):t;if(!Object.is(r,c)){if("object"!=typeof r)throw new Error("next state not object");const t=c;c=e?r:{...c,...r},i.forEach(e=>e(c,t))}}finally{s=!1}},b=()=>c,d=t=>(i.add(t),()=>{i.delete(t)}),f=(t,e,r)=>{let o=t(c);return d(()=>{const n=t(c);(r?r(o,n):Object.is(o,n))||(o=n,e(n,o))})},u=function(){var t=[].slice.call(arguments);return t[1]?f(...t):d(t[0])};return{...r(l,b,{subscribe:u}),useStore:(r,o,n)=>{const[s,i]=t(r(c));return e(()=>f(r,i,o),[n?.rebind&&r]),s},getState:b,setState:l,destroy:()=>i.clear(),subscribe:u}},o=(t,e)=>r((e,r)=>({dispatch:o=>(e(t(r(),o)),o)}),e);export{r as createStore,o as createStoreRedux};
