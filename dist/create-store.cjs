var t=require("react");exports.createStore=(e,r={},o={})=>{let s=!1,n={...r};const c=new Set,{allowNested:a=!0}=o,i=(t,e)=>{if(!a&&s)throw new Error("Nested state mutation disabled");try{s=!0;const r="function"==typeof t?t(n):t;if(!Object.is(r,n)){if("object"!=typeof r)throw new Error("next state not object");const t=n;n=e?r:{...n,...r},c.forEach(e=>e(n,t))}}finally{s=!1}},u=()=>n,l=t=>(c.add(t),()=>{c.delete(t)}),f=(t,e,r,o=t(n))=>{let s=o;return()=>{const o=t(n);(r?r(s,o):Object.is(s,o))||(e(o,s),s=o)}},b=function(){var t=[].slice.call(arguments);return l(t[1]?f(...t):t[0])};return{...e(i,u,{subscribe:b}),useStore:(e,r,o=!1)=>{const[{v:s,r:c},a]=t.useState({v:e(n),r:!!o});return t.useEffect(()=>{const t=f(e,t=>a({v:t,r:c}),r,s);return t(),l(t)},c?[e]:[]),s},getState:u,setState:i,destroy:()=>c.clear(),subscribe:b}};
