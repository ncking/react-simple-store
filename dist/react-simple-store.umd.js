!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e||self).reactSimpleStore={},e.react)}(this,function(e,t){const r=(e,r={},o={})=>{let n=!1,i={...r};const s=new Set,{allowNested:c=!0}=o,a=(e,t)=>{if(!c&&n)throw new Error("Nested state mutation disabled");try{n=!0;const r="function"==typeof e?e(i):e;if(!Object.is(r,i)){if("object"!=typeof r)throw new Error("next state not object");const e=i;i=t?r:{...i,...r},s.forEach(t=>t(i,e))}}finally{n=!1}},f=()=>i,d=e=>(s.add(e),()=>{s.delete(e)}),u=(e,t,r)=>{let o=e(i);return d(()=>{const n=e(i);(r?r(o,n):Object.is(o,n))||(t(n,o),o=n)})},l=function(){var e=[].slice.call(arguments);return e[1]?u(...e):d(e[0])};return{...e(a,f,{subscribe:l}),useStore:(e,r,o)=>{const[{value:n,rebind:s},c]=t.useState({value:e(i),rebind:!!o?.rebind});return t.useEffect(()=>u(e,e=>c({value:e,rebind:s}),r),s?[e]:[]),n},getState:f,setState:a,destroy:()=>s.clear(),subscribe:l}};e.createStore=r,e.createStoreRedux=(e,t)=>r((t,r)=>({dispatch:o=>(t(e(r(),o)),o)}),t)});
