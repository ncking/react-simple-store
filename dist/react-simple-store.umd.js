!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e||self).reactSimpleStore={},e.react)}(this,function(e,t){const r=(e,r={},o={})=>{let n=!1,c={...r};const s=new Set,{allowNested:i=!0}=o,a=(e,t)=>{if(!i&&n)throw new Error("Nested state mutation disabled");try{n=!0;const r="function"==typeof e?e(c):e;if(!Object.is(r,c)){if("object"!=typeof r)throw new Error("next state not object");const e=c;c=t?r:{...c,...r},s.forEach(t=>t(c,e))}}finally{n=!1}},f=()=>c,u=e=>(s.add(e),()=>{s.delete(e)}),d=(e,t,r,o=e(c))=>{let n=o;return()=>{const o=e(c);(r?r(n,o):Object.is(n,o))||(t(o,n),n=o)}},l=function(){var e=[].slice.call(arguments);return u(e[1]?d(...e):e[0])};return{...e(a,f,{subscribe:l}),useStore:(e,r,o=!1)=>{const[{v:n,r:s},i]=t.useState({v:e(c),r:!!o});return t.useEffect(()=>{const t=d(e,e=>i({v:e,r:s}),r,n);return t(),u(t)},s?[e]:[]),n},getState:f,setState:a,destroy:()=>s.clear(),subscribe:l}};e.createStore=r,e.createStoreRedux=(e,o)=>{const n=r((t,r)=>({dispatch:o=>t(e(r(),o))}),o),{useStore:c,dispatch:s}=n;return n.connect=(e,r)=>o=>n=>{const i=c(e);return t.createElement(o,{...n,...i,...r(s)})},n}});
