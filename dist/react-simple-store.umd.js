!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e||self).reactSimpleStore={},e.react)}(this,function(e,t){const n=(e,n={},r={})=>{let o=!1,c={...n};const s=new Set,{allowNested:i=!0}=r,a=(e,t)=>{if(!i&&o)throw new Error("Nested state mutation disabled");try{o=!0;const n="function"==typeof e?e(c):e;if(!Object.is(n,c)){if("object"!=typeof n)throw new Error("next state not object");const e=c;c=t?n:{...c,...n},s.forEach(t=>t(c,e))}}finally{o=!1}},u=()=>c,f=e=>(s.add(e),()=>{s.delete(e)}),l=(e,t,n,r=e(c))=>{let o=r;return()=>{const r=e(c);(n?n(o,r):Object.is(o,r))||(t(r,o),o=r)}},d=function(){var e=[].slice.call(arguments);return f(e[1]?l(...e):e[0])};return{...e(a,u,{subscribe:d}),useStore:(e,n,r=!1)=>{const[{v:o,r:s},i]=t.useState({v:e(c),r:!!r});return t.useEffect(()=>{const t=l(e,e=>i({v:e,r:s}),n,o);return t(),f(t)},s?[e]:[]),o},getState:u,setState:a,destroy:()=>s.clear(),subscribe:d}},r=(e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;const o=Object.prototype.hasOwnProperty.bind(t);for(let r=0;r<n.length;r++){const c=n[r];if(!o(c)||!Object.is(e[c],t[c]))return!1}return!0};e.createStore=n,e.createStoreRedux=(e,o)=>{const c=n((t,n)=>({dispatch:r=>t(e(n(),r))}),o),{useStore:s,dispatch:i}=c;return c.connect=(e,n)=>o=>{const c=c=>{const a=s(e,r);return t.createElement(o,{...c,...a,...n(i)})};return c.displayName=`Connect(${o.displayName||o.name||"Component"})`,c},c}});
