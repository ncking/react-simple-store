!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e||self).reactSimpleStore={},e.react)}(this,function(e,t){const r=(e,r={},o={})=>{let n,c=!1,s={...r};const i=new Set,{allowNested:f=!0}=o,a=(e,t)=>{if(!f&&c)throw new Error("Nested state mutation disabled");try{c=!0;const r="function"==typeof e?e(s):e;if(!Object.is(r,s)){if("object"!=typeof r)throw new Error("next state not object");const e=s;s=t?r:{...s,...r},n=performance.now(),i.forEach(t=>t(s,e))}}finally{c=!1}},u=()=>s,d=e=>(i.add(e),()=>{i.delete(e)}),l=(e,t,r)=>{let o=e(s);return()=>{const n=e(s);(r?r(o,n):Object.is(o,n))||(t(n,o),o=n)}},b=function(){var e=[].slice.call(arguments);return d(e[1]?l(...e):e[0])};return{...e(a,u,{subscribe:b}),useStore:(e,r,o=!1)=>{const c=t.useRef([o,n]),[{v:i},f]=t.useState({v:e(s)}),[a,u]=c.current;return t.useEffect(()=>{const t=l(e,e=>f({v:e}),r);return u!==n&&t(),d(t)},a?[e]:[]),i},getState:u,setState:a,destroy:()=>i.clear(),subscribe:b}};e.createStore=r,e.createStoreRedux=(e,t)=>r((t,r)=>({dispatch:o=>(t(e(r(),o)),o)}),t)});
